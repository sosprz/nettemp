#! /bin/bash  
dir=../..

date=`date +%y%m%d-%H%M`

rm -rf $dir/dbf/nettemp.db
rm -rf $dir/db/*.rrd
rm -rf $dir/img/view1/*.png                                           
rm -rf $dir/img/instant/*.png                                         
rm -rf $dir/tmp/log.txt
rm -rf $dir/tmp/.digitemprc
rm -rf $dir/tmp/onewire
rm -rf $dir/tmp/gammu*

sqlite3 $dir/dbf/nettemp.db  "CREATE TABLE sensors (
  id INTEGER PRIMARY KEY,
  name UNIQUE,
  rom UNIQUE,
  tmp float NOT NULL,
  tmp_min float NOT NULL,
  tmp_max float NOT NULL,
  alarm char(3) NOT NULL,
  hour char(3) NOT NULL,
  day char(3) NOT NULL,
  week char(3) NOT NULL,
  month char(3) NOT NULL,
  year char(3) NOT NULL,
  logoterma char(3) NOT NULL,
  color TEXT
  );"
 
sqlite3 $dir/dbf/nettemp.db "CREATE TABLE recipient (
  id INTEGER PRIMARY KEY,
  name TEXT,
  mail TEXT,
  tel NUMERIC,
  mail_alarm TEXT,
  sms_alarm TEXT
  );"
 
sqlite3 $dir/dbf/nettemp.db "CREATE TABLE users (
  id INTEGER PRIMARY KEY,
  login UNIQUE, 
  password TEXT, 
  perms TEXT
  );"

sqlite3 $dir/dbf/nettemp.db "CREATE TABLE mail_settings (
  id INTEGER PRIMARY KEY,
  host TEXT,
  port TEXT,
  user TEXT,
  password TEXT,
  address TEXT,
  test_mail TEXT
  );" 

sqlite3 $dir/dbf/nettemp.db "CREATE TABLE sms_settings (
  id INTEGER PRIMARY KEY,
  name TEXT,
  dev TEXT,
  sms_test TEXT,
  smsc TEXT,
  default_dev TEXT
  );" 

sqlite3 $dir/dbf/nettemp.db "CREATE TABLE device (
   id INTEGER PRIMARY KEY,
   usb UNIQUE,
   onewire UNIQUE
  );" 

sqlite3 $dir/dbf/nettemp.db "CREATE TABLE gpio (
  id INTEGER PRIMARY KEY,
  gpio UNIQUE,
  name TEXT,
  time_settings TEXT,
  end_time TEXT,
  custom_time TEXT,
  custom_time_on TEXT,
  gpio_temp_on TEXT,
  gpio_temp_sensor TEXT,
  gpio_temp_state TEXT,
  gpio_temp_set TEXT
    );"


sqlite3 $dir/dbf/nettemp.db "CREATE TABLE settings (
   id INTEGER PRIMARY KEY,
   mail TEXT,
   sms TEXT
  );"


sqlite3 $dir/dbf/nettemp.db "INSERT OR IGNORE INTO users (login, password, perms ) VALUES ('admin', 'd033e22ae348aeb5660fc2140aec35850c4da997', 'adm')"
sqlite3 $dir/dbf/nettemp.db "INSERT OR IGNORE INTO users (login, password, perms ) VALUES ('temp', 'd969831eb8a99cff8c02e681f43289e5d3d69664', 'ops')"
sqlite3 $dir/dbf/nettemp.db "INSERT INTO device (usb, onewire) VALUES ('off','off')"
sqlite3 $dir/dbf/nettemp.db "INSERT INTO settings (mail, sms) VALUES ('off','off')"
sqlite3 $dir/dbf/nettemp.db "INSERT INTO mail_settings (host, port, user ) VALUES ('smtp.gmail.com', '587', 'yourmail@gmail.com' )"



chmod 777 $dir/dbf/nettemp.db
echo "$date Default settings restored" >> $dir/tmp/log.txt
chmod 777 $dir/tmp/log.txt
